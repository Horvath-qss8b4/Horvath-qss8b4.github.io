<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <title>Messages CRUD – Űrlapos verzió</title>
    <script src="axios.min.js"></script>
    <style>
      body {
        font-family: Arial;
        padding: 20px;
      }
      table {
        border-collapse: collapse;
        margin-top: 20px;
      }
      table,
      th,
      td {
        border: 1px solid #444;
      }
      th,
      td {
        padding: 8px 12px;
      }
      input {
        margin: 5px 0;
        padding: 6px;
        width: 250px;
      }
      button {
        padding: 6px 12px;
        margin-top: 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>Messages CRUD (Űrlapos)</h1>

    <button onclick="loadMessages()">Lista frissítése</button>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Szöveg</th>
          <th>User ID</th>
          <th>Létrehozva</th>
          <th>Műveletek</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <hr />

    <h2>Új üzenet hozzáadása</h2>

    <form onsubmit="addMessage(); return false;">
      <label>Szöveg:</label><br />
      <input id="new_text" required /><br />

      <label>User ID:</label><br />
      <input id="new_user" required /><br />

      <button type="submit">Hozzáadás</button>
    </form>

    <hr />

    <h2>Üzenet módosítása</h2>

    <form onsubmit="updateMessage(); return false;">
      <label>Módosítandó ID:</label><br />
      <input id="update_id" required /><br />

      <label>Új szöveg:</label><br />
      <input id="update_text" required /><br />

      <button type="submit">Frissítés</button>
    </form>

    <script>
      function loadMessages() {
        axios.get("http://localhost:3000/messages").then((res) => {
          const tbody = document.getElementById("tbody");
          tbody.innerHTML = "";

          res.data.forEach((m) => {
            tbody.innerHTML += `
            <tr>
              <td>${m.message_id}</td>
              <td>${m.text}</td>
              <td>${m.user_id}</td>
              <td>${m.createdAt}</td>
              <td>
                <button onclick="fillUpdateForm(${m.message_id}, '${m.text.replace(/'/g, "\\'")}')">
                  Szerkesztés
                </button>
                <button onclick="deleteMessage(${m.message_id})">
                  Törlés
                </button>
              </td>
            </tr>
          `;
          });
        });
      }

      function addMessage() {
        axios
          .post("http://localhost:3000/messages", {
            text: document.getElementById("new_text").value,
            user_id: document.getElementById("new_user").value,
          })
          .then(() => {
            loadMessages();
          });
      }

      function fillUpdateForm(id, text) {
        document.getElementById("update_id").value = id;
        document.getElementById("update_text").value = text;
        window.scrollTo(0, document.body.scrollHeight);
      }

      function updateMessage() {
        const id = document.getElementById("update_id").value;
        const text = document.getElementById("update_text").value;

        axios
          .put(`http://localhost:3000/messages/${id}`, {
            text: text,
          })
          .then(() => loadMessages());
      }

      function deleteMessage(id) {
        axios.delete(`http://localhost:3000/messages/${id}`).then(() => loadMessages());
      }
    </script>
  </body>
</html>
------------------------------------------------------------------------------------------------------
const express = require("express");
const mysql = require("mysql2");
const cors = require("cors");

const app = express();
app.use(cors());
app.use(express.json());

// MySQL kapcsolat
const con = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "",
  database: "teszt_db",
});

con.connect();

app.get("/messages", (req, res) => {
  con.query("SELECT * FROM messages", (err, rows) => {
    res.json(rows);
  });
});

app.get("/messages/:id", (req, res) => {
  con.query("SELECT * FROM messages WHERE message_id=?", [req.params.id], (err, rows) => {
    res.json(rows[0]);
  });
});

app.post("/messages", (req, res) => {
  const sql = "INSERT INTO messages (text, createdAt, updatedAt, user_id) VALUES (?, NOW(), NOW(), ?)";
  con.query(sql, [req.body.text, req.body.user_id], (err, result) => {
    res.json({ id: result.insertId });
  });
});

app.put("/messages/:id", (req, res) => {
  const sql = "UPDATE messages SET text=?, updatedAt=NOW() WHERE message_id=?";
  con.query(sql, [req.body.text, req.params.id], () => {
    res.json({ status: "updated" });
  });
});

app.delete("/messages/:id", (req, res) => {
  con.query("DELETE FROM messages WHERE message_id=?", [req.params.id], () => {
    res.json({ status: "deleted" });
  });
});

app.listen(3000, () => console.log("API fut: http://localhost:3000"));
